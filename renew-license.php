<?php
require('CryptlexApi.php');
try {
    CryptlexApi::SetAccessToken("eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJzY29wZSI6WyJhY2NvdW50OnJlYWQiLCJhY2NvdW50OndyaXRlIiwiYWN0aXZhdGlvbjpyZWFkIiwiYW5hbHl0aWNzOnJlYWQiLCJhdXRvbWF0ZWRFbWFpbDpyZWFkIiwiYXV0b21hdGVkRW1haWw6d3JpdGUiLCJhdXRvbWF0ZWRFbWFpbEV2ZW50TG9nOnJlYWQiLCJldmVudExvZzpyZWFkIiwiZmVhdHVyZUZsYWc6cmVhZCIsImZlYXR1cmVGbGFnOndyaXRlIiwiaW52b2ljZTpyZWFkIiwibGljZW5zZTpyZWFkIiwibGljZW5zZTp3cml0ZSIsImxpY2Vuc2VQb2xpY3k6cmVhZCIsImxpY2Vuc2VQb2xpY3k6d3JpdGUiLCJtYWludGVuYW5jZVBvbGljeTpyZWFkIiwibWFpbnRlbmFuY2VQb2xpY3k6d3JpdGUiLCJvcmdhbml6YXRpb246cmVhZCIsIm9yZ2FuaXphdGlvbjp3cml0ZSIsInBheW1lbnRNZXRob2Q6cmVhZCIsInBheW1lbnRNZXRob2Q6d3JpdGUiLCJwZXJzb25hbEFjY2Vzc1Rva2VuOndyaXRlIiwicHJvZHVjdDpyZWFkIiwicHJvZHVjdDp3cml0ZSIsInByb2R1Y3RWZXJzaW9uOnJlYWQiLCJwcm9kdWN0VmVyc2lvbjp3cml0ZSIsInJlbGVhc2U6cmVhZCIsInJlbGVhc2U6d3JpdGUiLCJyZXNlbGxlcjpyZWFkIiwicmVzZWxsZXI6d3JpdGUiLCJyb2xlOnJlYWQiLCJyb2xlOndyaXRlIiwic2VnbWVudDpyZWFkIiwic2VnbWVudDp3cml0ZSIsInNlbmRpbmdEb21haW46cmVhZCIsInNlbmRpbmdEb21haW46d3JpdGUiLCJ0YWc6cmVhZCIsInRhZzp3cml0ZSIsInRyaWFsQWN0aXZhdGlvbjpyZWFkIiwidHJpYWxBY3RpdmF0aW9uOndyaXRlIiwidHJpYWxQb2xpY3k6cmVhZCIsInRyaWFsUG9saWN5OndyaXRlIiwidXNlcjpyZWFkIiwidXNlcjp3cml0ZSIsIndlYmhvb2s6cmVhZCIsIndlYmhvb2s6d3JpdGUiLCJ3ZWJob29rRXZlbnRMb2c6cmVhZCJdLCJzdWIiOiIyYTY1ZWM0My0xYWJjLTQxMDAtOWJjYi1hMGU4NDcyNGVjNGUiLCJlbWFpbCI6InJtLnNwYXJrbGUwMjNAZ21haWwuY29tIiwianRpIjoiYmM4ZjFlMTYtNjExYy00MWIzLWJkOTYtMGJjNDRjYTRkNjA3IiwiaWF0IjoxNzI1NDQyODA3LCJ0b2tlbl91c2FnZSI6InBlcnNvbmFsX2FjY2Vzc190b2tlbiIsInRlbmFudGlkIjoiYzI2ZThiZTItNjMwNC00YTU4LWE3ZTAtNDQxOTY1YjQ5NGZjIiwiZXhwIjoxNzY3MTE5NDAwLCJhdWQiOiJodHRwczovL2FwaS5jcnlwdGxleC5jb20ifQ.S2ST9MU5TPW1shFNaQa2Vm91yYZ4-pSDTwdyNOLsR9JGn7X6yH3NDtyo82gW91Osgs5SeBudvR_rHxtNbpO5_u3y_vCbic0gnLSAegVGMTkMjn64YRkad6efum2u7ut9TpMFYr8uGLQBHQq-FGIvYgTeVZ5KjGcIngJEshP6oK5bJZNHHkISqvGr4JEz-SUyMaI7N8_8J_M-63ArGr2kOT29gcquY1QzfKNiwRpwys9vrAMclJvfuuCZTHBTXhEUiMQi0P0itLeC5c3CT1xqxZkgGLiok8TZy70MRI-rDDdFmU_8F6WAGrSxmq6SI8-8kFO6m0G9Vx2459gLACaKrg");

    $product_id = "8bf8e8e0-7696-4ec6-8ed8-9d6f3693b8ed";

    $order_id = $_POST['order_id'];

    // license is searched using the order_id stored as metadata during license creation
    
    $license = CryptlexApi::RenewLicense($product_id, 'order_id', $order_id);

    http_response_code(200);
    echo "License new expiry date: ".$license->expiresAt;
} catch(Exception $e) {
    http_response_code(500);
    echo 'message: ' .$e->getMessage();
}